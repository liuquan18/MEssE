# MEssE 监测系统使用指南

## ✅ 已完成的设置

1. ✅ 从 main 分支成功复制了 `monitor` 文件夹
2. ✅ 修改了启动脚本以适配你的环境路径
3. ✅ 安装了 Flask 依赖
4. ✅ 生成了监测状态文件
5. ✅ 启动了监测服务器

## 🌐 访问监测界面

监测服务器正在运行，你可以通过以下方式访问：

### 方法 1: 本地访问（推荐）
如果你在 Levante 上工作：
```
http://localhost:5001
```

### 方法 2: SSH 端口转发
如果你从本地机器远程连接 Levante，需要设置 SSH 端口转发：

**在你的本地机器上运行：**
```bash
ssh -L 5001:localhost:5001 m301257@levante.dkrz.de
```

然后在本地浏览器中打开：
```
http://localhost:5001
```

### 方法 3: 网络直接访问
如果你在 DKRZ 内网：
```
http://levante1.lvt.dkrz.de:5001
或
http://136.172.124.2:5001
```

## 📊 监测界面功能

界面会显示以下信息：

### 🌍 ICON 模拟状态
- 开始时间
- 当前时间
- 运行时长
- 域数量
- 网格点数量
- 输出文件数

### 🧠 神经网络训练
- 当前 Loss 值
- 总批次数
- 每时间步批次数
- 学习率
- 平均 Loss
- 最小 Loss
- 实时 Loss 曲线图

**自动刷新：** 界面每 2 秒自动更新一次

## 🔄 管理监测服务器

### 停止服务器
按 `Ctrl+C` 停止服务器

### 重启服务器
```bash
cd /work/mh1498/m301257/work/MEssE/scripts/monitor
./start_monitor.sh
```

### 手动生成状态文件
如果需要手动更新监测状态：
```bash
cd /work/mh1498/m301257/work/MEssE/scripts/monitor
python generate_status.py
```

## 📁 文件说明

监测系统包含以下文件：

```
scripts/monitor/
├── monitor_server.py          # Flask Web 服务器
├── start_monitor.sh           # 启动脚本（已配置你的环境）
├── generate_status.py         # 生成状态文件的脚本
├── templates/
│   └── monitor.html          # Web 界面
├── README.md                 # 英文说明
├── QUICK_START.md            # 快速开始指南
├── MONITOR_README.md         # 详细文档
└── 使用说明.md               # 本文件（中文说明）
```

## 📍 数据位置

监测服务器从以下目录读取数据：
```
/scratch/m/m301257/icon_exercise_comin/
├── monitor_status.json        # 模拟状态（自动生成）
├── log_*.txt                  # 训练 loss 日志
└── net_*.pth                  # 模型检查点
```

## 🎯 当前状态

根据最新的数据：
- **模型类型**: MLP
- **当前 Loss**: 0.287672
- **总批次数**: 80
- **每时间步批次数**: 8
- **学习率**: 0.01
- **输出文件数**: 1469

## 💡 提示

1. **实时监测**: 服务器会自动读取最新的日志文件，无需重启
2. **端口占用**: 如果端口 5001 被占用，可以修改 `monitor_server.py` 中的端口号
3. **后台运行**: 如果需要在后台持续运行，可以使用 `nohup` 或 `screen`
4. **防火墙**: 如果无法访问，检查防火墙设置

## 🔧 故障排除

### 问题 1: 无法访问 Web 界面
- 检查服务器是否正在运行
- 确认端口号正确（5001）
- 尝试使用 SSH 端口转发

### 问题 2: 没有显示数据
- 确保 `/scratch/m/m301257/icon_exercise_comin/` 目录存在
- 运行 `python generate_status.py` 生成状态文件
- 检查日志文件是否存在

### 问题 3: Flask 错误
- 确认 Flask 已安装：`pip list | grep -i flask`
- 重新安装：`pip install flask`

## 📞 支持

如有问题，可以：
1. 查看详细文档：`MONITOR_README.md`
2. 查看快速指南：`QUICK_START.md`
3. 联系项目开发团队
